<!DOCTYPE html>
<html>
    <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="css/holo-base-elements.css" />
    <link rel="stylesheet" type="text/css" href="css/holo-light-elements.css" />
    <link rel="stylesheet" type="text/css" href="css/holo-base-widgets.css" />
    <link rel="stylesheet" type="text/css" href="css/holo-light-widgets.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <script type="text/javascript" src="js/holo-touch.js"></script>
    <script type="text/javascript" src="js/jquery-1.10.0.min.js"></script>
    <script type="text/javascript" src="js/handlebars.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/jquery-barcode.min.js"></script>  
    <script type="text/javascript" src="js/phonegap-1.2.0.js"></script>
    <title>TADL Mobile Beta</title>
</head>
<body>
<header class="holo-actionBar">
    <section class="searchform">
        <input class="search_box" style="float:left;" type="text" placeholder="Search..." id="term" />
        <button id="search" style="float:left;font-size:15px;">GO</button>
        <button id="search" style="float:right;font-size:15px;" onClick="openForm()">Account</button>
        <div style="clear:both"></div>

        <input class="search_second_row" type="checkbox" style="margin:5px;cursor:pointer;" id="available" value="false"><span class="search_second_row" style="margin:5px;">ONLY AVAILABLE</span>
        <select class="search_second_row" id="mediatype" style="margin-bottom:15px;margin-top:1px;">
            <option value="ALL">ALL FORMATS</option>
            <option value="BOOKS">BOOKS</option>
            <option value="MOVIES">MOVIES</option>
            <option value="MUSIC">MUSIC</option>
            <option value="VIDEO GAMES">VIDEO GAMES</option>
        </select>
    </section>
    <div id="login_form">
    Username: <input type="text" id="username" /><br />
    Password: <input type="password" id="pword" /><br />
    <button id="login" onClick="login()">Login</button>
    </div>
</header>

<div id="results">
</div>

<script id="more_details-template" type="text/template">
    {{#:items}}
        <p class="summary" style="position:relative">
        {{:item.:summary}}
        </p>
        <div class="bottomstuff">

            {{#compare :item.:copies_available null operator="!="}} 
           <h3 style="margin-top: 0px; margin-bottom: 0px; float: left;"><a onClick="hold({{:item.:record_id}})">Place Hold</a></h3>
           <h3 style="margin-top: 0px; margin-bottom: 0px; margin-left: 10px; float: left;">{{:item.:copies_available}} of {{:item.:copies_total}} available</h3>
           {{/compare}}
           {{#compare :item.:copies_available null operator="=="}}
         
           <h3 style="margin-top: 0px; margin-bottom: 0px; float: left;"><a href="{{:item.:eresource}}">View Online</a></h3>
           
           {{/compare}}
           
           
           
        </div>
       
        
         <div style="clear: both;"></div>       
               
         
                            <table>


  {{#compare :item.:copies_available 0 operator="!="}}
  {{#compare :item.:copies_available null operator="!="}}
      <th>Library:</th>
    <th>Location:</th>
    <th>Call #:</th>
   {{/compare}}
   {{/compare}}



       {{/:items}}
       
       

       
       
      {{#:shelvinglocations}}
       {{#if :shelf_location.:library}}
       <tr>
        <td>{{:shelf_location.:library}}</td>
        
        <td>{{:shelf_location.:shelving_location}}</td>
        <td>{{:shelf_location.:call_number}}</td>
        </tr>
        {{else}}
        <h1>lame</h1>
        {{/if}}
    {{/:shelvinglocations}}
    </table>

	
        <div style="clear: both;"></div>
        <div id="{{:item.:record_id}}shelf" style="display:none;"></div>
 
</script>


<script id="shelf-template" type="text/template">
    <table>
    <th>Library:</th>
    <th>Status:</th>
    <th>Shelving Location:</th>
    <th>Call Number:</th>

    {{#:items}}
        <tr>
        <td>{{:item.:library}}</td>
        <td>{{:item.:available}}</td>
        <td>{{:item.:shelving_location}}</td>
        <td>{{:item.:call_number}}</td>
        </tr>
    {{/:items}}
    </table>
</script>



<script id="logedin-template" type="text/template">
    {{#:users}}
        <p>
        {{:user.:name}}<br />
        <a onClick="showcheckouts()">Checkouts: {{:user.:checkouts}}</a><br />
        <a onClick="showholds()">Holds: {{:user.:holds}}</a><br />
        <a onClick="showpickups()">Ready for Pickup: {{:user.:pickups}}</a><br />
        Fines: {{:user.:fines}}
        </p>
        <button id="login" onclick="logout()">Logout</button>
        <button id="showbarcode" onclick="showcard()">Card</button>
    {{/:users}}
</script>


<script id="showcheckedout-template" type="text/template">
    {{#:checkouts}}
        <div class="shadow result">
        <img src="{{:checkout.:image}}" onerror="this.src='img/clocktower100.png';" class="result_img">
        <img src="{{:checkout.:format_icon}}">{{:checkout.:name}}<br/>
        <div id="{{:checkout.:barcode}}">
        Due on: {{:checkout.:due_date}}<br/>
        Remaining Renewals: {{:checkout.:renew_attempts}}<br/>
        <a onClick="renew({{:checkout.:checkout_id}},{{:checkout.:barcode}})">Attempt Renewal</a>
        </div> 
        </div>
    {{/:checkouts}}
</script>


<script id="showevents-template" type="text/template">
    {{#nodes}}
        <div class="shadow result pointer" onclick="unhide({{node.nid}})">
        <div class="result_img">
        {{#if node.image}}
            <img src="{{node.image}}">
        {{else}}
            <img src="img/clocktower100.png">
        {{/if}}
        </div><span style="font-size:1.3em;">{{node.title}}</span><br>
        <strong>{{node.event-date}} - {{node.location}}</strong><br>
        <span id="more{{node.nid}}" style="font-size:0.8em;">click for details</span>
        <span id="{{node.nid}}" style="display:none;">{{node.body}}</span>
        </div>
    {{/nodes}}
</script>

<script id="showlocations-template" type="text/template">
    {{#nodes}}
        <div class="shadow result pointer" onclick="unhide('{{node.shortname}}')">
        <img class="location_img" src="http://www.tadl.org/sites/default/files/libraryphotos/{{node.shortname}}-200x125.jpg">{{node.title}}
        <h3 style="padding:0;margin:0;">{{node.fullname}}</h3>
        {{node.address}}<br/>
        {{node.citystatezip}}<br/>
        {{node.phone}}<br/>
        <span id="more{{node.shortname}}" style="font-size:0.8em;">click for hours</span>
        <span id="{{node.shortname}}" style="display:none;">
        <table>
        <tr><td>Sunday</td><td>{{node.sunday}}</td></tr>
        <tr><td>Monday</td><td>{{node.monday}}</td></tr>
        <tr><td>Tuesday</td><td>{{node.tuesday}}</td></tr>
        <tr><td>Wednesday</td><td>{{node.wednesday}}</td></tr>
        <tr><td>Thursday</td><td>{{node.thursday}}</td></tr>
        <tr><td>Friday</td><td>{{node.friday}}</td></tr>
        <tr><td>Saturday</td><td>{{node.saturday}}</td></tr>
        </table>
        </div>
        </div>
    {{/nodes}}
</script>



<script id="showholds-template" type="text/template">
    {{#:holds}}
        <div id="{{:hold.:hold_id}}" class="shadow result">
        <img class="result_img" src="{{:hold.:image}}" onerror="this.src='img/clocktower100.png';">
        <img src="{{:hold.:format_icon}}">{{:hold.:name}}<br/>
        Pickup Location: {{:hold.:pickup_location}}<br/>
        Status: {{:hold.:status}}<br/>
        <a onClick="cancelhold({{:hold.:hold_id}})">Cancel Hold</a>
        </div>
    {{/:holds}}
</script>



<script id="renew-template" type="text/template">
    {{#:checkouts}}
        Due on: {{:checkout.:due_date}}<br/>
        Remaining Renewal Attempts: {{:checkout.:renew_attempts}}<br/>
        <a onClick="renew({{:checkout.:checkout_id}},{{:checkout.:barcode}})">Attempt Renewal</a>
    {{/:checkouts}}
</script>


<script id="results-template" type="text/template">
    {{#:items}}
        <div class="shadow result">
        <div onclick="showmore({{:item.:record_id}});">
        <img class="result_img" onerror="this.src='img/clocktower100.png';" src="{{:item.:image}}">
        <h2 class="title"><img src="{{:item.:format_icon}}">{{:item.:title}}</h2>
        <h3 class="author">{{:item.:author}}</h3>
        </div>
        <div id="{{:item.:record_id}}" style="display:none;"></div>
        <div id="{{:item.:record_id}}-loading"></div> 
        </div>
        <div style=" clear: both;"></div>
    {{/:items}}
</script>

<div class="load_more" class="shadow">
    <div id="loadmoretext"></div>
</div>
<script>
Handlebars.registerHelper('compare', function(lvalue, rvalue, options) {

    if (arguments.length < 3)
        throw new Error("Handlerbars Helper 'compare' needs 2 parameters");

    operator = options.hash.operator || "==";


    var operators = {
        '==':       function(l,r) { return l == r; },
        '===':      function(l,r) { return l === r; },
        '!=':       function(l,r) { return l != r; },
        '<':        function(l,r) { return l < r; },
        '>':        function(l,r) { return l > r; },
        '<=':       function(l,r) { return l <= r; },
        '>=':       function(l,r) { return l >= r; },
        'typeof':   function(l,r) { return typeof l == r; }
    }

    if (!operators[operator])
        throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);

    var result = operators[operator](lvalue,rvalue);

    if( result ) {
        return options.fn(this);
    } else {
        return options.inverse(this);
    }

});
</script>

<footer class="holo-actionBar smallfoot"><span><a onclick="showevents()" class="button">Events</a> <a onclick="showlocations()" class="button">Locations</a></span></footer>

</body>
</html>
